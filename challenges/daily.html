<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Word Search ‚Äî Touch Fixed</title>
  <style>
    :root {
      --bg-1: #0b1020;
      --bg-2: #0f1726;
      --panel: rgba(255, 255, 255, 0.04);
      --panel-2: rgba(255, 255, 255, 0.03);
      --muted: #9aa3d6;
      --ink: #e9eeff;
      --accent: linear-gradient(135deg, #6c8cff, #7ef0d6);
      --accent-plain: #6c8cff;
      --good: #35d67a;
      --warn: #ffc857;
      --bad: #ff6b6b;
      --glass: rgba(255, 255, 255, 0.04);
      --shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      --cell-size: 55px;
    }

    body.light {
  --bg-1: #f8f9fb;
  --bg-2: #ffffff;
  --panel: rgba(0, 0, 0, 0.05);
  --panel-2: rgba(0, 0, 0, 0.03);
  --muted: #555;
  --ink: #222;
  --accent: linear-gradient(135deg, #4f6bff, #06c);
  --accent-plain: #4f6bff;
  --good: #28a745;
  --warn: #e0a800;
  --bad: #dc3545;
  --glass: rgba(0, 0, 0, 0.04);
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

/* Theme toggle switch */
.theme-switch {
  position: relative;
  display: inline-block;
  width: 52px;
  height: 28px;
}

.theme-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background: var(--panel);
  border-radius: 50px;
  transition: background 0.3s;
}

.slider::before {
  content: "";
  position: absolute;
  height: 20px;
  width: 20px;
  left: 4px;
  top: 4px;
  background: var(--ink);
  border-radius: 50%;
  transition: transform 0.3s, background 0.3s;
}

.theme-switch input:checked + .slider {
  background: var(--accent-plain);
}

.theme-switch input:checked + .slider::before {
  transform: translateX(24px);
  background: #fff;
}

    /* base */
    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(108, 140, 255, 0.06), transparent),
        radial-gradient(1000px 500px at 90% 90%, rgba(126, 240, 214, 0.03), transparent),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 10px;
      transition: background 300ms ease;
    }

    a {
      text-decoration: none;
      color: white;
    }

    /* container */
    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      transform-origin: center;
      transition: filter .22s ease, transform .22s ease, opacity .22s ease;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      width: 100%;
    }

    header .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 46px;
      height: 46px;
      border-radius: 10px;
      background: linear-gradient(135deg, #4f6bff, #7ef0d6);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #03102a;
      box-shadow: 0 6px 18px rgba(80, 110, 255, 0.14);
      transform: translateZ(0);
    }

    .title {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.02em
    }

    .stats,
    .controls {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: space-around;
      margin: 0 auto;
      max-width: 650px;
      width: 100%;
    }

    .stat {
      background: var(--panel);
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: 700;
      color: var(--muted);
      box-shadow: var(--shadow);
      min-width: 80px;
      text-align: center;
    }

    button {
      border: 0;
      background: var(--accent-plain);
      color: white;
      padding: 8px 14px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(30, 40, 80, 0.25);
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s;
    }

    button.secondary {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--muted)
    }

    button:active {
      transform: translateY(1px) scale(.995)
    }

    button.ghost {
      background: transparent;
      border: 0;
      color: var(--muted)
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
      justify-content: center;
      width: 100%;
      align-items: center;
    }

    .board,
    .side {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.015));
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(3, 6, 20, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(6px);
      max-width: 600px;
      width: 100%;
    }

    .grid {
      --size: 10;
      display: grid;
      grid-template-columns: repeat(var(--size), var(--cell-size));
      gap: 2px;
      justify-content: center;
      padding: 12px;
      user-select: none;
      touch-action: none;
    }

    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
      display: grid;
      place-items: center;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      font-weight: 800;
      text-transform: uppercase;
      color: var(--ink);
      transition: transform .12s ease, box-shadow .18s ease, background .18s, outline-color .18s;
      box-shadow: inset 0 -2px 6px rgba(0, 0, 0, 0.25);
      cursor: pointer;
      font-size: 14px;
      user-select: none;
    }

    .cell:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(2, 6, 23, 0.6)
    }

    /* highlights & found */
    .cell.hl {
      outline: 2px solid rgba(255, 200, 90, 0.15);
      animation: pulse 900ms infinite linear;
    }

   .cell.good {
      outline: 2px solid var(--good);
      animation: goodPulse 700ms ease-in-out;
    } 

    .cell.lock {
      background: linear-gradient(135deg, rgba(55, 214, 122, 0.12), rgba(32, 80, 255, 0.06));
      box-shadow: 0 10px 30px rgba(50, 120, 255, 0.06), inset 0 -6px 10px rgba(0, 0, 0, 0.25);
      transform: scale(1.02);
      color: #eafef3;
      transition: transform .24s cubic-bezier(.2, .9, .25, 1), background .22s;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 200, 90, 0.06)
      }

      70% {
        box-shadow: 0 0 0 8px rgba(255, 200, 90, 0)
      }

      100% {
        box-shadow: 0 0 0 0 rgba(255, 200, 90, 0)
      }
    }

    @keyframes goodPulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.03);
      }

      100% {
        transform: scale(1);
      }
    }

    .words {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 12px
    }

    .word {
      background: rgba(255, 255, 255, 0.02);
      padding: 8px 10px;
      border-radius: 8px;
      font-weight: 700;
      color: var(--muted);
    }

    .word.found {
      color: var(--good);
      text-decoration: line-through;
      opacity: 0.95
    }

    .msg {
      margin-top: 12px;
      color: var(--muted);
      font-weight: 600
    }

    /* modals */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 900;
      pointer-events: none;
    }

    .modal.open {
      display: flex;
      pointer-events: auto;
    }

    .modal .backdrop {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(2, 6, 23, 0.55), rgba(2, 6, 23, 0.55));
      backdrop-filter: blur(6px) saturate(120%);
      opacity: 0;
      transition: opacity .24s ease;
    }

    .modal.open .backdrop {
      opacity: 1
    }

    .card {
      position: relative;
      background: linear-gradient(180deg, rgba(101, 112, 212, 0.486), rgba(255, 255, 255, 0.01));
      border-radius: 14px;
      padding: 22px;
      width: min(520px, 92%);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.04);
      transform: translateY(24px) scale(.985);
      opacity: 0;
      transition: transform .36s cubic-bezier(.2, .9, .2, 1), opacity .36s ease;
      box-shadow: 0 30px 80px rgba(2, 8, 30, 0.6);
    }

    .modal.open .card {
      transform: translateY(0) scale(1);
      opacity: 1
    }


    .card h2 {
      margin: 4px 0 8px;
      font-size: 20px
    }

    .card p {
      margin: 0 0 16px;
      color: var(--muted);
      font-weight: 600
    }

    .modal .controls {
      justify-content: center
    }

    .modal .small {
      font-size: 13px;
      color: var(--muted)
    }

    /* result numbers */
    .big-num {
      font-size: 36px;
      font-weight: 900;
      margin: 8px 0;
      letter-spacing: -0.02em
    }
    

    /* blur the content behind modal for cross-browser safety */
    body.modal-open .wrap {
      filter: blur(8px) scale(.997);
      pointer-events: none;
      user-select: none
    }

    /* score animation */
    .score-pop {
      display: inline-block;
      transition: transform .28s cubic-bezier(.2, .9, .2, 1);
    }

    .score-pop.pop {
      transform: translateY(-8px) scale(1.08);
    }

    /* responsive */
    @media (max-width:880px) {
      main {
        grid-template-columns: 1fr;
      }

      .grid {
        transform: scale(.92)
      }

      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px
      }
    }

    button .text {
    font-family: 'waytoon';
}

button {
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #4162a8;
    border-top: 1px solid #38538c;
    border-right: 1px solid #1f2d4d;
    border-bottom: 1px solid #151e33;
    border-left: 1px solid #1f2d4d;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    -moz-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    color: #fff;
    font: bold 20px "helvetica neue", helvetica, arial, sans-serif;
    line-height: 1;
    padding: 10px 0 12px 0;
    text-align: center;
    text-shadow: 0px -1px 1px #1e2d4d;
    width: 150px;
    -webkit-background-clip: padding-box;
    margin: 15px;
}

button:hover {
    -webkit-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    -moz-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
    cursor: pointer;
}

button:active {
    -webkit-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
    -moz-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
    box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
    transform: translateY(4px);
}

    @media (max-width: 625px) {
      :root {
        --cell-size: 44px;
      }
      .board,
      .side {
        max-width: 430px;
      }
    }

    @media (max-width: 450px) {
      :root {
        --cell-size: 35px;
      }

      .board,
      .side {
        max-width: 350px;
      }
      .word {
        font-size: .7em;
      }
    }
        @media (max-width: 370px) {
      :root {
        --cell-size: 30px;
      }
          #timer {
      font-size: .7em;
    }

      .board,
      .side {
        max-width: 300px;
  
      }
    }
  </style>
</head>

<body>
  <div class="wrap" aria-live="polite">
    <header>
      <label class="theme-switch">
  <input type="checkbox" id="themeToggle" />
  <span class="slider"></span>
</label>

      <div class="stats">
        <div id="score"><span class="score-pop">üèÜ 0</span></div>
        <div id="best" style="display: none;"></div>
        <button id="pauseBtn" class="secondary" title="Pause game"><div id="timer">‚è∏ 0:00</div></button>
      </div>

      <div class="controls" style="display: none;">

      </div>
    </header>

    <main>
      <section class="board" aria-label="Puzzle board">
        <div id="grid" class="grid" role="grid" aria-label="Word search grid"></div>
      </section>

      <aside class="side" aria-label="Words & info">
        <div id="wordList" class="words" aria-live="polite"></div>
        <div id="msg" class="msg" style="display: none;">Press start to play today‚Äôs puzzle.</div>
      </aside>
    </main>
  </div>

  <!-- Start modal -->
  <div class="modal open" id="startModal" role="dialog" aria-modal="true" aria-labelledby="start-title">
    <div class="backdrop" aria-hidden="true"></div>
    <div class="card">
      <h2 id="start-title">Ready for today‚Äôs puzzle?</h2>
      <p class="small" style="color:var(--muted)">Try to beat your best time. Words may
        appear forwards or backwards.</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:8px">
        <button id="startModalBtn">‚ñ∂</button>
        <button id="openExample" class="secondary"><a href="../home/home.html">Back</a></button>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">Puzzle refreshes every day</div>
    </div>
  </div>

  <!-- Pause modal -->
  <div class="modal" id="pauseModal" role="dialog" aria-modal="true" aria-labelledby="pause-title">
    <div class="backdrop" aria-hidden="true"></div>
    <div class="card">
      <h3 id="pause-title">Game paused</h3>
      <p class="small" style="color:var(--muted)">Take a breather ‚Äî timer is stopped.</p>
      <div class="controls" style="justify-content:center">
        <button id="resumeBtn">‚ñ∂</button>
        <button id="quitBtn" class="secondary">Quit</button>
      </div>
    </div>
  </div>

  <!-- Game over modal -->
  <div class="modal" id="gameOverModal" role="dialog" aria-modal="true" aria-labelledby="go-title">
    <div class="backdrop" aria-hidden="true"></div>
    <div class="card">
      <h2 id="go-title">You did it!</h2>
      <div id="goSummary" style="margin:6px 0 12px;color:var(--muted)"></div>
      <div class="big-num" id="goTime">0:00</div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button id="playAgain">‚Üª Play again</button>
        <button id="closeGameOver" class="secondary">Close</button>
      </div>
    </div>
  </div>

  <script>
    /* -------------------------
       Utilities & RNG
       ------------------------- */
    function seededFromDate(d = new Date()) {
      const y = d.getFullYear(), m = d.getMonth() + 1, day = d.getDate();
      let str = `${y}-${m}-${day}`;
      let h = 2166136261 >>> 0;
      for (let i = 0; i < str.length; i++) { h ^= str.charCodeAt(i); h = Math.imul(h, 16777619); }
      return h >>> 0;
    }
    function rng(seed) { let s = seed >>> 0; return () => { s = Math.imul(1664525, s) + 1013904223 >>> 0; return s / 0x100000000; } }

    /* -------------------------
       Wordbank & directions
       ------------------------- */
    const WORD_BANK = "JAVASCRIPT CODE PUZZLE LOGIC MATRIX FUNCTION OBJECT DAILY TIMER SCORE WORD SEARCH".split(" ");
    const DIRS = [
      [1, 0], [-1, 0], [0, 1], [0, -1],
      [1, 1], [1, -1], [-1, 1], [-1, -1]
    ];

    /* -------------------------
       Puzzle builder
       ------------------------- */
    function buildPuzzle({ size = 10, words = [], seed }) {
      const R = rng(seed);
      const grid = Array.from({ length: size }, () => Array(size).fill(null));
      function canPlace(w, r, c, dr, dc) {
        const r2 = r + dr * (w.length - 1), c2 = c + dc * (w.length - 1);
        if (r2 < 0 || r2 >= size || c2 < 0 || c2 >= size) return false;
        for (let i = 0; i < w.length; i++) {
          const rr = r + dr * i, cc = c + dc * i;
          if (grid[rr][cc] && grid[rr][cc] !== w[i]) return false;
        }
        return true;
      }
      function placeWord(w) {
        for (let tries = 0; tries < 500; tries++) {
          const dir = DIRS[Math.floor(R() * DIRS.length)];
          const [dr, dc] = dir;
          const r = Math.floor(R() * size), c = Math.floor(R() * size);
          if (!canPlace(w, r, c, dr, dc)) continue;
          for (let i = 0; i < w.length; i++) grid[r + dr * i][c + dc * i] = w[i];
          return true;
        }
        return false;
      }
      for (const word of words) {
        const w = R() < 0.5 ? word : word.split("").reverse().join("");
        placeWord(w);
      }
      for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) if (!grid[r][c]) grid[r][c] = String.fromCharCode(65 + Math.floor(R() * 26));
      return { grid };
    }
/* -------------------------
   Theme toggle
   ------------------------- */
/* -------------------------
   Theme toggle
   ------------------------- */
const themeToggle = document.getElementById("themeToggle");

function applyTheme(theme) {
  if (theme === "light") {
    document.body.classList.add("light");
    themeToggle.checked = true;
  } else {
    document.body.classList.remove("light");
    themeToggle.checked = false;
  }
}

function loadTheme() {
  const saved = localStorage.getItem("theme") || "dark";
  applyTheme(saved);
}

themeToggle.addEventListener("change", () => {
  const newTheme = themeToggle.checked ? "light" : "dark";
  localStorage.setItem("theme", newTheme);
  applyTheme(newTheme);
});

loadTheme();


    /* -------------------------
       DOM refs
       ------------------------- */
    const gridEl = document.getElementById('grid');
    const wordListEl = document.getElementById('wordList');
    const timerEl = document.getElementById('timer');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const msgEl = document.getElementById('msg');

    const startModalBtn = document.getElementById('startModalBtn');
    const startModal = document.getElementById('startModal');
    const openExample = document.getElementById('openExample');

    const pauseBtn = document.getElementById('pauseBtn');
    const pauseModal = document.getElementById('pauseModal');
    const resumeBtn = document.getElementById('resumeBtn');
    const quitBtn = document.getElementById('quitBtn');

    const gameOverModal = document.getElementById('gameOverModal');
    const goSummary = document.getElementById('goSummary');
    const goTime = document.getElementById('goTime');
    const playAgain = document.getElementById('playAgain');
    const closeGameOver = document.getElementById('closeGameOver');

    /* -------------------------
       State
       ------------------------- */
    let state = {
      running: false, paused: false,
      seed: seededFromDate(),
      grid: null, words: [], target: new Set(), found: new Set(),
      score: 0, startTs: 0, elapsedPause: 0,
      pointerDown: false, pointerId: null, startCell: null, currentLine: []
    };
    let timerId = null;

    /* -------------------------
   Completion persistence helpers
------------------------- */
function completedKey() { return "daily-completed-" + state.seed; }
function isCompleted() { return !!localStorage.getItem(completedKey()); }
function markCompleted() {
  localStorage.setItem(completedKey(), "1");
  updateStartButton();
}
function updateStartButton() {
  if (!startModalBtn) return;
  if (isCompleted()) {
    startModalBtn.disabled = true;
    startModalBtn.textContent = "‚úì Completed";
    startModalBtn.title = "You already completed today's puzzle";
    startModalBtn.style.opacity = "0.7";
    if (playAgainBtn) playAgainBtn.disabled = true;
  } else {
    startModalBtn.disabled = false;
    startModalBtn.textContent = "‚ñ∂";
    startModalBtn.title = "Start";
    startModalBtn.style.opacity = "1";
    if (playAgainBtn) playAgainBtn.disabled = false;
  }
}


    /* -------------------------
       Modal helpers
       ------------------------- */
    function anyModalOpen() {
      return Array.from(document.querySelectorAll('.modal')).some(m => m.classList.contains('open'));
    }
    function openModal(modal) {
      modal.classList.add('open');
      document.body.classList.add('modal-open');
    }
    function closeModal(modal) {
      modal.classList.remove('open');
      if (!anyModalOpen()) document.body.classList.remove('modal-open');
    }
    if (startModal.classList.contains('open')) document.body.classList.add('modal-open');

    /* -------------------------
       Rendering
       ------------------------- */
    function renderGrid(grid) {
      gridEl.style.setProperty('--size', grid.length);
      gridEl.innerHTML = "";
      for (let r = 0; r < grid.length; r++) {
        for (let c = 0; c < grid[r].length; c++) {
          const d = document.createElement('div');
          d.className = 'cell';
          d.dataset.r = r; d.dataset.c = c;
          d.textContent = grid[r][c];
          d.setAttribute('role', 'button');
          gridEl.appendChild(d);
        }
      }
    }
    function safeId(w) { return 'w-' + w.replace(/\s+/g, '_'); }
    function renderWords(words) {
      wordListEl.innerHTML = "";
      words.forEach(w => {
        const d = document.createElement('div'); d.className = 'word'; d.id = safeId(w); d.textContent = w; wordListEl.appendChild(d);
      });
    }
    function setMessage(t) { msgEl.textContent = t; }

    /* -------------------------
       Timer & best
       ------------------------- */
    function startTimer() {
      clearInterval(timerId); timerId = setInterval(() => {
        if (!state.running || state.paused) return;
        const e = Math.floor((Date.now() - state.startTs - state.elapsedPause) / 1000);
        timerEl.textContent = `‚è∏ ${Math.floor(e / 60)}:${String(e % 60).padStart(2, '0')}`;
      }, 500);
    }
    function updateBestDisplay() { const key = "daily-best-" + state.seed; const b = localStorage.getItem(key); bestEl.textContent = "Best: " + (b || "‚Äî"); }
    function recordBest() {
      const e = Math.floor((Date.now() - state.startTs - state.elapsedPause) / 1000);
      const mm = Math.floor(e / 60), ss = String(e % 60).padStart(2, '0');
      const f = `${mm}:${ss}`;
      const key = "daily-best-" + state.seed;
      const prev = localStorage.getItem(key) || "999:59";
      const toSec = s => s.includes(":") ? (+s.split(":")[0]) * 60 + (+s.split(":")[1]) : +s;
      if (toSec(f) < toSec(prev)) localStorage.setItem(key, f);
      updateBestDisplay();
    }

    /* -------------------------
       Setup puzzle
       ------------------------- */
    function setupDaily() {
      const R = rng(state.seed);
      const shuffled = [...WORD_BANK].sort(() => R() - 0.5);
      state.words = shuffled.slice(0, 8);
      state.target = new Set(state.words);
      state.found = new Set();
      const { grid } = buildPuzzle({ size: 10, words: state.words, seed: state.seed });
      state.grid = grid;
      renderGrid(grid);
      renderWords(state.words);
      setMessage("Daily puzzle. Straight lines only.");
      state.score = 0;
      scoreEl.querySelector('.score-pop').textContent = 'üèÜ 0';
      updateBestDisplay();
    }

    /* -------------------------
       Selection helpers
       ------------------------- */
    function cellFromPoint(x, y) {
      const el = document.elementFromPoint(x, y);
      if (!el) return null;
      const cell = el.closest('.cell');
      if (!cell) return null;
      return { r: +cell.dataset.r, c: +cell.dataset.c, el: cell };
    }
    function normalizeDir(dr, dc) {
      const s = n => n > 0 ? 1 : n < 0 ? -1 : 0;
      const r = s(dr), c = s(dc);
      // allow straight or perfect diagonal only
      if (r !== 0 && c !== 0 && Math.abs(dr) !== Math.abs(dc)) return null;
      return [r, c];
    }
    function lineCells(from, to) {
      if (!from || !to) return [];
      const dr = to.r - from.r, dc = to.c - from.c;
      const nd = normalizeDir(dr, dc);
      if (!nd) return [];
      const [rstep, cstep] = nd;
      const len = Math.max(Math.abs(dr), Math.abs(dc));
      const out = [];
      for (let i = 0; i <= len; i++) {
        out.push({ r: from.r + rstep * i, c: from.c + cstep * i });
      }
      return out;
    }
    function pathToWord(path) {
      return path.map(p => state.grid[p.r][p.c]).join("");
    }
    function clearHighlights() {
      // remove hl/good from previously highlighted elements (but keep locked ones)
      (state.currentLine || []).forEach(p => {
        if (p && p.el && !p.el.classList.contains('lock')) {
          p.el.classList.remove('hl', 'good');
        }
      });
    }
    function highlightPath(path, good = false) {
      path.forEach(p => {
        const el = gridEl.querySelector(`.cell[data-r="${p.r}"][data-c="${p.c}"]`);
        if (el) {
          if (!el.classList.contains('lock')) el.classList.add(good ? 'good' : 'hl');
          p.el = el;
        }
      });
    }
    function lockPath(path) {
      path.forEach(p => {
        const el = gridEl.querySelector(`.cell[data-r="${p.r}"][data-c="${p.c}"]`);
        if (el) el.classList.add('lock');
      });
    }
    function animateScore() {
      const el = scoreEl.querySelector('.score-pop');
      el.classList.add('pop');
      setTimeout(() => el.classList.remove('pop'), 380);
    }

    /* -------------------------
       Pointer (mouse/touch) handling (unified)
       ------------------------- */
    function beginPointerInteraction(evt) {
      if (!state.running || state.paused) return;
      // left mouse button only (for mouse); pointerType 'touch' will have button = 0
      if (evt.pointerType === 'mouse' && evt.button !== 0) return;
      evt.preventDefault();
      state.pointerDown = true;
      state.pointerId = evt.pointerId;
      try { gridEl.setPointerCapture(state.pointerId); } catch (e) { }
      const cell = cellFromPoint(evt.clientX, evt.clientY);
      if (!cell) return;
      state.startCell = { r: cell.r, c: cell.c };
      state.currentLine = [cell];
      clearHighlights();
      highlightPath(state.currentLine);
    }

    function movePointerInteraction(evt) {
      if (!state.pointerDown || !state.running || state.paused) return;
      if (state.pointerId && evt.pointerId !== state.pointerId) return;
      evt.preventDefault();
      const cell = cellFromPoint(evt.clientX, evt.clientY);
      if (!cell) return;
      const path = lineCells(state.startCell, cell);
      clearHighlights();
      if (path.length) {
        state.currentLine = path;
        highlightPath(path);
      } else {
        // if path invalid, show nothing
        state.currentLine = [];
      }
    }

    function endPointerInteraction(evt) {
      if (!state.pointerDown) return;
      if (state.pointerId && evt.pointerId !== state.pointerId) return;
      evt.preventDefault();
      try { if (state.pointerId) gridEl.releasePointerCapture(state.pointerId); } catch (e) { }
      state.pointerDown = false;
      state.pointerId = null;

      // If we have a currentLine (even if pointer ended outside), evaluate it
      const path = state.currentLine || [];
      if (!path.length) { clearHighlights(); state.currentLine = []; return; }

      const w = pathToWord(path);
      const rev = w.split("").reverse().join("");
      let match = null;
      if (state.target.has(w)) match = w;
      else if (state.target.has(rev)) match = rev;

      if (match && !state.found.has(match)) {
        state.found.add(match);
        state.score++;
        scoreEl.querySelector('.score-pop').textContent = 'üèÜ ' + state.score;
        animateScore();
        lockPath(path);
        highlightPath(path, true);
        const id = safeId(match);
        const wk = document.getElementById(id);
        if (wk) wk.classList.add('found');
        setMessage("Nice! +" + (match.length) + " points");
        // vibration if available (short)
        if (navigator.vibrate) navigator.vibrate(30);
        // when complete
if (state.found.size === state.target.size) {
  markCompleted(); // <--- NEW
  state.running = false;
  clearInterval(timerId);
  recordBest();
  setTimeout(() => showGameOver(true), 260);
}

      } else {
        setMessage("Only straight lines allowed ‚Äî try again!");
      }

      clearHighlights();
      state.currentLine = [];
    }

    gridEl.addEventListener('pointerdown', beginPointerInteraction, { passive: false });
    gridEl.addEventListener('pointermove', movePointerInteraction, { passive: false });
    gridEl.addEventListener('pointerup', endPointerInteraction, { passive: false });
    gridEl.addEventListener('pointercancel', endPointerInteraction, { passive: false });

    /* -------------------------
       Pause / Resume / Quit
       ------------------------- */
    function doPause() {
      if (!state.running || state.paused) return;
      state.paused = true;
      state.pauseStart = Date.now();
      openModal(pauseModal);
    }
    function doResume() {
      if (!state.running || !state.paused) return;
      state.paused = false;
      state.elapsedPause += Date.now() - state.pauseStart;
      closeModal(pauseModal);
    }
    function doQuit() {
      state.running = false;
      clearInterval(timerId);
      closeModal(pauseModal);
      openModal(startModal);
      setMessage("Press start to play today‚Äôs puzzle.");
    }

    /* -------------------------
       Start / Restart / Gameover
       ------------------------- */
    function startGame() {
      setupDaily();
      state.running = true;
      state.paused = false;
      state.elapsedPause = 0;
      state.startTs = Date.now();
      startTimer();
      setMessage("Find the words ‚Äî straight lines only.");
      closeModal(startModal);
    }

    function resetForPlayAgain() {
      state.seed = seededFromDate();
      setupDaily();
      state.running = true;
      state.paused = false;
      state.startTs = Date.now();
      state.elapsedPause = 0;
      startTimer();
      closeModal(gameOverModal);
    }

    function showGameOver(won = true) {
      const elapsed = Math.floor((Date.now() - state.startTs - state.elapsedPause) / 1000);
      const mm = Math.floor(elapsed / 60), ss = String(elapsed % 60).padStart(2, '0');
      goTime.textContent = `${mm}:${ss}`;
      goSummary.textContent = `Score: ${state.score} ¬∑ Found ${state.found.size}/${state.target.size} words`;
      openModal(gameOverModal);
      setMessage(won ? "All words found ‚Äî great job!" : "Game over");
    }

    /* -------------------------
       Event wiring (buttons, keyboard)
       ------------------------- */
    startModalBtn.addEventListener("click", () => {
  if (isCompleted()) {
    setMessage("You already completed today's puzzle.");
    return;
  }
  startGame();
});

    openExample.addEventListener('click', () => setMessage("Preview: draw straight lines to select words. Words may be backwards."));

    pauseBtn.addEventListener('click', doPause);
    resumeBtn.addEventListener('click', doResume);
    quitBtn.addEventListener('click', doQuit);

    playAgain.addEventListener('click', () => resetForPlayAgain());
    closeGameOver.addEventListener('click', () => closeModal(gameOverModal));

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (state.running) {
          if (state.paused) doResume(); else doPause();
        }
      }
      if (e.key === 'Escape') {
        if (pauseModal.classList.contains('open')) doResume();
        else if (gameOverModal.classList.contains('open')) closeModal(gameOverModal);
        else if (startModal.classList.contains('open')) closeModal(startModal);
      }
    });

    /* -------------------------
       Bootstrap preview grid
       ------------------------- */
    (function bootstrap() {
      const previewSeed = state.seed ^ 1234;
      const { grid } = buildPuzzle({ size: 10, words: ["START", "PLAY"], seed: previewSeed });
      updateStartButton();
      renderGrid(grid);
      // startModal left open by default
    })();
  </script>
</body>

</html>